<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>../src/easynode/framework/server/http/KOAHttpServer.js - EasyNode API参考文档</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="EasyNode API参考文档" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: EasyNode - 0.1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/#NAMESPACE#.FileService.html">#NAMESPACE#.FileService</a></li>
                                <li><a href="../classes/EasyNode.html">EasyNode</a></li>
                                <li><a href="../classes/easynode.framework.ActionAOP.ActionAOP.html">easynode.framework.ActionAOP.ActionAOP</a></li>
                                <li><a href="../classes/easynode.framework.aop.AOP.html">easynode.framework.aop.AOP</a></li>
                                <li><a href="../classes/easynode.framework.BeanFactory.html">easynode.framework.BeanFactory</a></li>
                                <li><a href="../classes/easynode.framework.cache.CacheStat.html">easynode.framework.cache.CacheStat</a></li>
                                <li><a href="../classes/easynode.framework.cache.ICache.html">easynode.framework.cache.ICache</a></li>
                                <li><a href="../classes/easynode.framework.cache.Memcached.html">easynode.framework.cache.Memcached</a></li>
                                <li><a href="../classes/easynode.framework.cache.Redis.html">easynode.framework.cache.Redis</a></li>
                                <li><a href="../classes/easynode.framework.db.IConnection.html">easynode.framework.db.IConnection</a></li>
                                <li><a href="../classes/easynode.framework.db.IDataSource.html">easynode.framework.db.IDataSource</a></li>
                                <li><a href="../classes/easynode.framework.db.MysqlConnection.html">easynode.framework.db.MysqlConnection</a></li>
                                <li><a href="../classes/easynode.framework.db.MysqlDataSource.html">easynode.framework.db.MysqlDataSource</a></li>
                                <li><a href="../classes/easynode.framework.Logger.html">easynode.framework.Logger</a></li>
                                <li><a href="../classes/easynode.framework.mq.IQueue.html">easynode.framework.mq.IQueue</a></li>
                                <li><a href="../classes/easynode.framework.mq.RedisListQueue.html">easynode.framework.mq.RedisListQueue</a></li>
                                <li><a href="../classes/easynode.framework.mq.RedisQueue.html">easynode.framework.mq.RedisQueue</a></li>
                                <li><a href="../classes/easynode.framework.mvc.Action.html">easynode.framework.mvc.Action</a></li>
                                <li><a href="../classes/easynode.framework.mvc.ActionArgConverter.html">easynode.framework.mvc.ActionArgConverter</a></li>
                                <li><a href="../classes/easynode.framework.mvc.ActionContext.html">easynode.framework.mvc.ActionContext</a></li>
                                <li><a href="../classes/easynode.framework.mvc.ActionExecutor.html">easynode.framework.mvc.ActionExecutor</a></li>
                                <li><a href="../classes/easynode.framework.mvc.ActionFactory.html">easynode.framework.mvc.ActionFactory</a></li>
                                <li><a href="../classes/easynode.framework.mvc.ActionFilter.html">easynode.framework.mvc.ActionFilter</a></li>
                                <li><a href="../classes/easynode.framework.mvc.ActionRequestParameter.html">easynode.framework.mvc.ActionRequestParameter</a></li>
                                <li><a href="../classes/easynode.framework.mvc.ActionResult.html">easynode.framework.mvc.ActionResult</a></li>
                                <li><a href="../classes/easynode.framework.mvc.CombinedAction.html">easynode.framework.mvc.CombinedAction</a></li>
                                <li><a href="../classes/easynode.framework.mvc.EJSTemplateViewRenderer.html">easynode.framework.mvc.EJSTemplateViewRenderer</a></li>
                                <li><a href="../classes/easynode.framework.mvc.IActionContextListener.html">easynode.framework.mvc.IActionContextListener</a></li>
                                <li><a href="../classes/easynode.framework.mvc.ITemplateViewRenderer.html">easynode.framework.mvc.ITemplateViewRenderer</a></li>
                                <li><a href="../classes/easynode.framework.mvc.JadeTemplateViewRenderer.html">easynode.framework.mvc.JadeTemplateViewRenderer</a></li>
                                <li><a href="../classes/easynode.framework.mvc.JSONView.html">easynode.framework.mvc.JSONView</a></li>
                                <li><a href="../classes/easynode.framework.mvc.MethodDispatchedAction.html">easynode.framework.mvc.MethodDispatchedAction</a></li>
                                <li><a href="../classes/easynode.framework.mvc.Model.html">easynode.framework.mvc.Model</a></li>
                                <li><a href="../classes/easynode.framework.mvc.ModelField.html">easynode.framework.mvc.ModelField</a></li>
                                <li><a href="../classes/easynode.framework.mvc.ModelProxyActionFactory.html">easynode.framework.mvc.ModelProxyActionFactory</a></li>
                                <li><a href="../classes/easynode.framework.mvc.MustacheTemplateViewRenderer.html">easynode.framework.mvc.MustacheTemplateViewRenderer</a></li>
                                <li><a href="../classes/easynode.framework.mvc.spi.MysqlModelGenerator.html">easynode.framework.mvc.spi.MysqlModelGenerator</a></li>
                                <li><a href="../classes/easynode.framework.mvc.View.html">easynode.framework.mvc.View</a></li>
                                <li><a href="../classes/easynode.framework.plugin.EasyNodePlugin.html">easynode.framework.plugin.EasyNodePlugin</a></li>
                                <li><a href="../classes/easynode.framework.plugin.PluginLoadContext.html">easynode.framework.plugin.PluginLoadContext</a></li>
                                <li><a href="../classes/easynode.framework.queue.MQTTQueue.html">easynode.framework.queue.MQTTQueue</a></li>
                                <li><a href="../classes/easynode.framework.server.AbstractServer.html">easynode.framework.server.AbstractServer</a></li>
                                <li><a href="../classes/easynode.framework.server.http.KOAActionContext.html">easynode.framework.server.http.KOAActionContext</a></li>
                                <li><a href="../classes/easynode.framework.server.http.KOADefaultRoutes.html">easynode.framework.server.http.KOADefaultRoutes</a></li>
                                <li><a href="../classes/easynode.framework.server.http.KOAHttpRequestParameter.html">easynode.framework.server.http.KOAHttpRequestParameter</a></li>
                                <li><a href="../classes/easynode.framework.server.http.KOAHttpServer.html">easynode.framework.server.http.KOAHttpServer</a></li>
                                <li><a href="../classes/easynode.framework.server.http.KOAHttpServer.SessionSupport.html">easynode.framework.server.http.KOAHttpServer.SessionSupport</a></li>
                                <li><a href="../classes/easynode.framework.server.KOAMemorySessionStorage.html">easynode.framework.server.KOAMemorySessionStorage</a></li>
                                <li><a href="../classes/easynode.framework.server.ServerStat.html">easynode.framework.server.ServerStat</a></li>
                                <li><a href="../classes/easynode.framework.server.tcp.Decoder.html">easynode.framework.server.tcp.Decoder</a></li>
                                <li><a href="../classes/easynode.framework.server.tcp.Encoder.html">easynode.framework.server.tcp.Encoder</a></li>
                                <li><a href="../classes/easynode.framework.server.tcp.Message.html">easynode.framework.server.tcp.Message</a></li>
                                <li><a href="../classes/easynode.framework.server.tcp.MessageHandler.html">easynode.framework.server.tcp.MessageHandler</a></li>
                                <li><a href="../classes/easynode.framework.server.tcp.protocols.JSONDecoder.html">easynode.framework.server.tcp.protocols.JSONDecoder</a></li>
                                <li><a href="../classes/easynode.framework.server.tcp.protocols.JSONEncoder.html">easynode.framework.server.tcp.protocols.JSONEncoder</a></li>
                                <li><a href="../classes/easynode.framework.server.tcp.protocols.JSONMessageHandler.html">easynode.framework.server.tcp.protocols.JSONMessageHandler</a></li>
                                <li><a href="../classes/easynode.framework.server.tcp.StreamDecoderHelper.html">easynode.framework.server.tcp.StreamDecoderHelper</a></li>
                                <li><a href="../classes/easynode.framework.server.tcp.StreamEncoderHelper.html">easynode.framework.server.tcp.StreamEncoderHelper</a></li>
                                <li><a href="../classes/easynode.framework.server.tcp.TCPClient.html">easynode.framework.server.tcp.TCPClient</a></li>
                                <li><a href="../classes/easynode.framework.server.tcp.TCPServer.html">easynode.framework.server.tcp.TCPServer</a></li>
                                <li><a href="../classes/easynode.framework.test.TestCase.html">easynode.framework.test.TestCase</a></li>
                                <li><a href="../classes/easynode.framework.test.TestCaseRunner.html">easynode.framework.test.TestCaseRunner</a></li>
                                <li><a href="../classes/easynode.framework.util.Binary.html">easynode.framework.util.Binary</a></li>
                                <li><a href="../classes/easynode.framework.util.HTTPUtil.html">easynode.framework.util.HTTPUtil</a></li>
                                <li><a href="../classes/easynode.framework.util.MustacheHelper.html">easynode.framework.util.MustacheHelper</a></li>
                                <li><a href="../classes/easynode.framework.util.MyError.html">easynode.framework.util.MyError</a></li>
                                <li><a href="../classes/easynode.framework.util.ObjectWrapper.html">easynode.framework.util.ObjectWrapper</a></li>
                                <li><a href="../classes/easynode.framework.util.SqlUtil.html">easynode.framework.util.SqlUtil</a></li>
                                <li><a href="../classes/easynode.framework.util.StringUtil.html">easynode.framework.util.StringUtil</a></li>
                                <li><a href="../classes/easynode.framework.util.VersionComparator.html">easynode.framework.util.VersionComparator</a></li>
                                <li><a href="../classes/easynode.framework.view.TemplateView.html">easynode.framework.view.TemplateView</a></li>
                                <li><a href="../classes/easynode.GenericObject.html">easynode.GenericObject</a></li>
                                <li><a href="../classes/全局函数.html">全局函数</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: ../src/easynode/framework/server/http/KOAHttpServer.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var assert = require(&#x27;assert&#x27;);
var thunkify = require(&#x27;thunkify&#x27;);
var Logger = using(&#x27;easynode.framework.Logger&#x27;);
var _  = require(&#x27;underscore&#x27;);
var fs = require(&#x27;co-fs&#x27;);
var f =  require(&#x27;fs&#x27;);
var logger = Logger.forFile(__filename);
var AbstractServer = using(&#x27;easynode.framework.server.AbstractServer&#x27;);
var S = require(&#x27;string&#x27;);
var koa = require(&#x27;koa&#x27;);
var staticFileServe = require(&#x27;koa-static&#x27;);
var favicon = require(&#x27;koa-favicon&#x27;);
var path = require(&#x27;path&#x27;);
var session = require(&#x27;koa-generic-session&#x27;);
var accessLogger = Logger.getLogger(&#x27;access&#x27;);
var route = require(&#x27;koa-route&#x27;);
var multipart = require(&#x27;co-multipart&#x27;);
var qs = require(&#x27;koa-qs&#x27;);
var render = require(&#x27;koa-ejs&#x27;);
var AdmZip = require(&#x27;adm-zip&#x27;);

var KOAHttpRequestParameter = using(&#x27;easynode.framework.server.http.KOAHttpRequestParameter&#x27;);



(function () {
        var PROXY_IP_HEADER = EasyNode.config(&#x27;easynode.servers.koa-HttpServer.proxyIPHeader&#x27;, &#x27;x-forwarded-for&#x27;);
        const HTTP_METHODS = [
                &#x27;all&#x27;,          //virtual method
                &#x27;del&#x27;,          //virtual method, equal to delete
                &#x27;get&#x27;,
                &#x27;post&#x27;,
                &#x27;put&#x27;,
                &#x27;head&#x27;,
                &#x27;delete&#x27;,
                &#x27;options&#x27;,
                &#x27;trace&#x27;,
                &#x27;copy&#x27;,
                &#x27;lock&#x27;,
                &#x27;mkcol&#x27;,
                &#x27;move&#x27;,
                &#x27;purge&#x27;,
                &#x27;propfind&#x27;,
                &#x27;proppatch&#x27;,
                &#x27;unlock&#x27;,
                &#x27;report&#x27;,
                &#x27;mkactivity&#x27;,
                &#x27;checkout&#x27;,
                &#x27;merge&#x27;,
                &#x27;m-search&#x27;,
                &#x27;notify&#x27;,
                &#x27;subscribe&#x27;,
                &#x27;unsubscribe&#x27;,
                &#x27;patch&#x27;,
                &#x27;search&#x27;,
                &#x27;connect&#x27;
        ];

        var filters = {

        };
        /**
         * KOAHttpServer封装了一个koa Application，预定义了access logger，csrf，session, routes等中间件，并支持通过API方式向koa Application
         * 增加新的中间件、路由。&lt;br&gt;
         * 中间件和路由的加载顺序：favicon-&gt;access log-&gt;static files(包括所有静态文件目录)-&gt;session-&gt;csrf-&gt;$middlewares-&gt;default routes-&gt;$extra routes-&gt;$middleware-after-routes
         * &lt;h5&gt;使用参考：&lt;/h5&gt;
         * &lt;pre&gt;
         *
         *
                         require(&#x27;../src/EasyNode.js&#x27;);
                         EasyNode.addSourceDirectory(&#x27;src&#x27;);
                         var co = require(&#x27;co&#x27;);
                         var assert = require(&#x27;assert&#x27;);
                         var logger = using(&#x27;easynode.framework.Logger&#x27;).getLogger();

                         var KOAHttpServer = using(&#x27;easynode.framework.server.http.KOAHttpServer&#x27;);
                         var server = new KOAHttpServer();

                         // redis session存储
                         //server.setSessionStorage(KOAHttpServer.SessionSupport.STORAGE_REDIS, {
                        //        host : &#x27;127.0.0.1&#x27;,
                        //        port : 6379
                        //});

                         // memcached session存储
                         //server.setSessionStorage(KOAHttpServer.SessionSupport.STORAGE_MEMCACHED, {
                        //        host : &#x27;127.0.0.1&#x27;,
                        //        port : 11211
                        //});

                         // memory session 存储
                         server.setSessionStorage(KOAHttpServer.SessionSupport.STORAGE_MEMORY);

                         //增加一个WEB目录。
                         server.addWebDirs(&#x27;plugins/demo/www/&#x27;);

                         //增加一个中间件
                         server.addMiddleware(function * (next) {
                        console.log(&#x27;this message is printed anytime&#x27;);
                        console.log(this.parameter.param(&#x27;a&#x27;));
                        console.log(this.parameter.param(&#x27;b&#x27;));
                        console.log(this.parameter.dateParam(&#x27;c&#x27;));
                        console.log(this.remoteAddress);                        //客户端IP地址
                                yield next;
                        });

                         //增加一个在路由之后的中间件
                         server.addMiddlewareAfterRoutes(function * (next) {
                        console.log(&#x27;this message is printed when no route was found&#x27;);
                                this.type = &#x27;json&#x27;;
                                this.body = {
                                        hello : &#x27;EasyNode&#x27;
                                };
                                yield next;
                        });

                         //增加一个路由
                         server.addRoute(&#x27;get&#x27;, &#x27;/abc.jsp&#x27;, function * () {
                                 this.body = &#x27;This is abc.jsp&#x27;;
                        });

                         //启动服务

                         co(function * (){
                                yield server.start();
                        }).catch(onError());

                         //错误处理
                         function onError(err) {
                                if(err) {
                                        logger.error(err);
                                }
                        }
         *  &lt;/pre&gt;
         * @class easynode.framework.server.http.KOAHttpServer
         * @extends easynode.GenericObject
         * @since 0.1.0
         * @author zlbbq
         * */
        class KOAHttpServer extends AbstractServer {
                /**
                 * 构造函数。
                 *
                 * @method 构造函数
                 * @param {int} port 端口，默认5000
                 * @since 0.1.0
                 * @author zlbbq
                 * */
                constructor(port=S(EasyNode.config(&#x27;easynode.servers.koa-HttpServer.port&#x27;, &#x27;5000&#x27;)).toInt()) {
                        super(port, EasyNode.config(&#x27;easynode.servers.koa-HttpServer.name&#x27;, &#x27;koa-HttpServer&#x27;));
                        //调用super()后再定义子类成员。

                        /**
                         *  HTTP服务的根目录，默认配置项：easynode.servers.koa-HttpServer.rootDirectory或www
                         * @property _webRoot
                         * @type String
                         * @private
                         *
                         * */
                        var _webRoot = EasyNode.real(EasyNode.config(&#x27;easynode.servers.koa-HttpServer.webRoot&#x27;, &#x27;www/&#x27;));

                        /**
                         *  设置HTTP服务根目录。
                         * @method setWebRoot
                         * @param {String} webRoot HTTP服务根目录，相对路径
                         * @since 0.1.0
                         * @author zlbbq
                         * */
                        this.setWebRoot = function(webRoot) {
                                _webRoot = EasyNode.real(webRoot);
                        };

                        /**
                         *  获取HTTP服务根目录。
                         * @method getWebRoot
                         * @return {String} 返回HTTP服务根目录
                         * @since 0.1.0
                         * @author zlbbq
                         * */
                        this.getWebRoot = function() {
                                return _webRoot;
                        };

                        /**
                         *  上传文件目录，默认www/uploads
                         * @property _uploadDir
                         * @type String
                         * @private
                         * */
                        var _uploadDir = EasyNode.real(EasyNode.config(&#x27;easynode.servers.koa-HttpServer.uploadDir&#x27;, &#x27;www/uploads/&#x27;));

                        /**
                         * 上传文件目录前缀，默认/uploads
                         * @property _uploadURIPrefix
                         * @type String
                         * @private
                         * */
                        var _uploadURIPrefix = EasyNode.config(&#x27;easynode.servers.koa-HttpServer.uploadURIPrefix&#x27;,&#x27;/uploads/&#x27;);

                        /**
                         *  设置文件上传目录。
                         * @method setUploadDir
                         * @param {String} uploadDir HTTP服务根目录，相对路径
                         * @since 0.1.0
                         * @author zlbbq
                         * */
                        this.setUploadDir = function(uploadDir) {
                                _uploadDir = EasyNode.real(uploadDir);
                        };
                        /**
                         *  获取HTTP服务上传目录。
                         * @method getUploadDir
                         * @return {String} 返回HTTP服务上传目录
                         * @since 0.1.0
                         * @author zlbbq
                         * */
                        this.getUploadDir = function() {
                                return _uploadDir;
                        };

                        /**
                         * 获取HTTP服务上伟目录相对路径
                         * @method getUploadURIPrefix
                         * @return {String} 返回HTTP服务上传目录相对路径
                         * @since 0.1.0
                         * @author allen.hu
                         */
                         this.getUploadURIPrefix = function() {
                            return _uploadURIPrefix;
                         };

                        var _writeAccessLog = S(EasyNode.config(&#x27;easynode.servers.koa-HttpServer.writeAccessLog&#x27;,  &#x27;true&#x27;)).toBoolean();
                        /**
                         *  设置服务是否记录访问日志
                         * @method writeAccessLog
                         * @param {boolean} flag 是否记录访问日志
                         * @since 0.1.0
                         * @author zlbbq
                         * */
                        this.writeAccessLog = function(flag) {
                                if(arguments.length == 0) {
                                        return _writeAccessLog;
                                }
                                assert(typeof flag == &#x27;boolean&#x27;, &#x27;Invalid argument&#x27;);
                                _writeAccessLog = flag;
                        };

                        /**
                         *  Session 存储类型，默认KOAHttpServer.SessionSupport.STORAGE_MEMORY
                         * @property _sessionStorage
                         * @type String
                         * @private
                         * */
                        this._sessionStorage = &#x27;storage-memory&#x27;;
                        /**
                         *  Session 存储选项，默认null
                         * @property _sessionStorageOptions
                         * @type object
                         * @private
                         * */
                        this._sessionStorageOptions = null;

                        /**
                         *  koa app的key
                         * @property _keys
                         * @type array
                         * @private
                         * */
                        this._keys = EasyNode.config(&#x27;easynode.servers.koa-HttpServer.keys&#x27;, &#x27;EasyNode&#x27;).split(&#x27;,&#x27;);

                }

                /**
                 *  增加静态文件查找目录
                 * @method addWebDirs
                 * @param {String} arr 静态文件列表，相对于EasyNode的目录。
                 * @since 0.1.0
                 * @author zlbbq
                 * */
                addWebDirs (...arr) {
                        this._webDirs = this._webDirs || [];
                        arr.forEach(dir =&gt; {
                                assert(typeof dir == &#x27;string&#x27;, &#x27;Invalid arguments&#x27;);
                                this._webDirs.push(dir);
                        });
                }

                /**
                 *  增加动态模板查找目录，仅允许一个目录
                 *  @method addTemplateDirs
                 *  @param {String} arr 模板文件列表，相对于EasyNode的目录
                 *  @since 0.1.0
                 *  @autho allen.hu
                 * */
                addTemplateDirs(...arr) {
                        this._templateDirs = this._templateDirs || [];
                        assert( arr.length == 1, &#x27;template dire number, only one&#x27;);
                        arr.forEach( dir =&gt; {
                            assert(typeof dir == &#x27;string&#x27;, &#x27;Invalid arguments&#x27;);
                            this._templateDirs.push(dir);
                        });
                }

                 /**
                 *  设置koa的KEY
                 * @method setKeys
                 * @param {...} keys Key列表，每个KEY是string。
                 * @since 0.1.0
                 * @author zlbbq
                 * */
                setKeys (...keys) {
                        assert(keys.length &gt; 0, &#x27;Invalid arguments&#x27;);
                        this._keys = keys;
                }

                /**
                 *  增加中间件，中间件是一个generator函数，请注意：中间件会按先后顺序添加到koa，具体流程请参考start函数。
                 *  在任何中间件中可以访问koa ctx对象，即中间件generator函数中的this对象，的parameter对象，该成员是
                 *  easynode.framework.server.http.KOAHttpRequestParameter类实例，用于获取HTTP请求参数和上传的文件。
                 *
                 * @method addMiddleware
                 * @param {generator} gen generator函数，符合koa中间件规范
                 * @since 0.1.0
                 * @author zlbbq
                 * @example
                 *
                 *      server.addMiddleware(function * (next) {
                 *               console.log(&#x27;this message is printed anytime&#x27;);
                 *               console.log(this.parameter.param(&#x27;a&#x27;));
                 *               console.log(this.parameter.param(&#x27;b&#x27;));
                 *               console.log(this.parameter.dateParam(&#x27;c&#x27;));
                 *               yield next;
                 *       });
                 * */
                addMiddleware (gen) {
                        this._middlewares = this._middlewares || [];
                        this._middlewares.push(gen);
                }

                /**
                 *  增加中间件(在Routes之后)，中间件是一个generator函数，请注意：中间件会按先后顺序添加到koa，具体流程请参考start函数。
                 *  在任何中间件中可以访问koa ctx对象，即中间件generator函数中的this对象，的parameter对象，该成员是
                 *  easynode.framework.server.http.KOAHttpRequestParameter类实例，用于获取HTTP请求参数和上传的文件。
                 *
                 * @method addMiddlewareAfterRoutes
                 * @param {generator} gen generator函数，符合koa中间件规范
                 * @since 0.1.0
                 * @author zlbbq
                 * @example
                 *       server.addMiddlewareAfterRoutes(function * (next) {
                 *               console.log(&#x27;this message is printed when no route was found&#x27;);
                 *               this.type = &#x27;json&#x27;;
                 *               this.body = {
                 *                       hello : &#x27;EasyNode&#x27;
                 *               };
                 *               yield next;
                 *       });
                 * */
                addMiddlewareAfterRoutes (gen) {
                        this._middlewaresAfterRoutes = this._middlewaresAfterRoutes || [];
                        this._middlewaresAfterRoutes.push(gen);
                }

                /**
                 *  增加一个路由。
                 * 在任何路由中可以访问koa ctx对象，即中间件generator函数中的this对象，的parameter对象，该成员是
                 *  easynode.framework.server.http.KOAHttpRequestParameter类实例，用于获取HTTP请求参数和上传的文件。
                 *
                 * @method addRoute
                 * @param {String} method http method，支持&quot;all&quot;, &quot;get&quot;, &quot;post&quot;, &quot;put&quot;, &quot;delete&quot;
                 * @param {String} uri, 以&quot;/&quot;开头
                 * @param {generator} gen, 路由generator函数
                 * @since 0.1.0
                 * @author zlbbq
                 * @example
                 *      server.addRoute(&#x27;get&#x27;, &#x27;/abc.jsp&#x27;, function * () {
                 *               this.body = &#x27;This is abc.jsp&#x27;;
                 *      });
                 *
                 * */
                addRoute (method, uri, gen) {
                        assert(typeof method == &#x27;string&#x27; &amp;&amp; typeof uri == &#x27;string&#x27;, &#x27;Invalid http method&#x27;);
                        method = method.toLowerCase();
                        assert(_.contains(HTTP_METHODS, method), &#x60;Invalid http method [${method}] of route, supported methods are: [${HTTP_METHODS.join(&#x27;,&#x27;)}]&#x60;);
                        this._routes = this._routes || [];
                        this._routes.push({
                                method : method,
                                uri : uri,
                                gen : gen
                        });
                }

                /**
                 *  设置Session的存储类型，默认Session支持为内存存储，这容易引起内存泄漏，请不要用于生产环境。
                 *
                 * @method setSessionStorage
                 * @param {String} storage 存储类型, KOAHttpServer.SessionSupport.STORAGE_*
                 * @param {object} opt 参数，使用KOAHttpServer.SessionSupport.STORAGE_MEMORY时，忽略此参数。
                 * @since 0.1.0
                 * @author zlbbq
                 * @example
                 *      var KOAHttpServer = using(&#x27;easynode.framework.server.http.KOAHttpServer&#x27;);
                 *      var server = new KOAHttpServer();
                 *
                 *      //use memory session
                 *      server.setSessionStorage(KOAHttpServer.SessionSupport.STORAGE_MEMORY);
                 *
                 *      //use redis session storage
                 *      server.setSessionStorage(KOAHttpServer.SessionSupport.STORAGE_REDIS, {
                 *              host : &#x27;127.0.0.1&#x27;,
                 *              port : 6379,
                 *              db : &#x27;EasyNode_Session&#x27;,
                 *              pass : &#x27;password_of_db&#x27;
                 *      });
                 *
                 *      //use memcached session storage
                 *      server.setSessionStorage(KOAHttpServer.SessionSupport.STORAGE_MEMCACHED, {
                 *              host : &#x27;127.0.0.1&#x27;,
                 *              port : 11211
                 *      });
                 * */
                setSessionStorage(storage, opt) {
                        assert(typeof storage == &#x27;string&#x27;, &#x27;Invalid argument&#x27;);
                        assert(_.contains([
                                                KOAHttpServer.SessionSupport.STORAGE_MEMORY,
                                                KOAHttpServer.SessionSupport.STORAGE_REDIS,
                                                KOAHttpServer.SessionSupport.STORAGE_MEMCACHED
                                        ], storage), &#x60;Invalid session storage [${storage}]&#x60;);
                        this._sessionStorage = storage;
                        this._sessionStorageOptions = opt;
                }

                /**
                 *  设置HTTP Server是否启用CSRF防御。默认禁用。启用时需要koa-csrf模块支持。
                 *
                 * @method enableCSRF
                 * @param {boolean} flag true-启用；false-禁用。
                 * @since 0.1.0
                 * @author zlbbq
                 **/
                enableCSRF (flag) {
                        assert(typeof flag == &#x27;boolean&#x27;, &#x27;Invalid argument&#x27;);
                        this._enableCSRF = flag;
                }

                /**
                 *  设置HTTP Server是否启用404中间件。默认启用。可以通过addMiddlewareAfterRoutes函数自行增加一个404处理中间件，在这个
                 *  中间件中不调用yield next中止downstream中间件可以达到同样的效果。KOAHttpServer的404中间件总是位于中间件最底端。
                 *
                 * @method enableCSRF
                 * @param {boolean} flag true-启用；false-禁用。
                 * @since 0.1.0
                 * @author zlbbq
                 **/
                enable404Middleware (flag) {
                        assert(typeof flag == &#x27;boolean&#x27;, &#x27;Invalid argument&#x27;);
                        this._enable404Middleware = flag;
                }

                /**
                 *  设置KOAActionContext的事件处理器。可在此注入数据库支持、缓存支持、队列支持等等。&lt;br/&gt;
                 *  这是一个非常重要的函数，用于设置EasyNode中所有Action的调用上下文，包括数据库连接使用，cache使用，MQ使用
                 *  等，这些对象的使用，EasyNode已经抽象出相应的接口。&lt;br/&gt;
                 *  EasyNode的新版本可能会再抽象其他一些通用的功能接口
                 *
                 * @method setActionContextListener
                 * @param @param {easynode.framework.mvc.IActionContextListener} l ActionContext事件监听器
                 * @since 0.1.0
                 * @author zlbbq
                 **/
                setActionContextListener (l) {
                        this._actionContextListener = l;
                }

                /**
                 *  返回session的storage对象，符合koa-generic-session接口定义。get、set、destroy。
                 *
                 * @method _getSessionStore
                 * @return {object} storage 存储对象。实现get、set、destroy接口。
                 * @private
                 * @since 0.1.0
                 * @author zlbbq
                 * */
                _getSessionStore () {
                        this._sessionStorage = this._sessionStorage || KOAHttpServer.SessionSupport.STORAGE_MEMORY;
                        switch (this._sessionStorage) {
                                case KOAHttpServer.SessionSupport.STORAGE_MEMORY :
                                {
                                        return this._createMemoryStorage();
                                }
                                case KOAHttpServer.SessionSupport.STORAGE_REDIS :
                                {
                                        return this._createRedisStorage();
                                }
                                case KOAHttpServer.SessionSupport.STORAGE_MEMCACHED :
                                {
                                        return this._createMemcachedStorage();
                                }
                                default :
                                {
                                        throw new Error(&#x60;Unsupported session storage [${this._sessionStorage}]&#x60;);
                                }
                        }
                }

                /**
                 *  session内存存储
                 *
                 * @method _createMemoryStorage
                 * @return {object} session内存存储对象。实现get、set、destroy接口。
                 * @private
                 * @since 0.1.0
                 * @author zlbbq
                 * */
                _createMemoryStorage () {
                        var MSS = using(&#x27;easynode.framework.server.http.KOAMemorySessionStorage&#x27;);
                        return new MSS();
                }

                /**
                 *  session redis存储
                 *
                 * @method _createRedisStorage
                 * @return {object} session redis存储对象。koa-redis模块支持。
                 * @private
                 * @since 0.1.0
                 * @author zlbbq
                 * */
                _createRedisStorage () {
                        var redisStore = require(&#x27;koa-redis&#x27;);
                        return redisStore(this._sessionStorageOptions);
                }

                /**
                 *  session memcached存储
                 *
                 * @method _createMemcachedStorage
                 * @return {object} session memcached存储对象。koa-memcached模块支持。
                 * @private
                 * @since 0.1.0
                 * @author zlbbq
                 * */
                _createMemcachedStorage () {
                        var memcachedStore = require(&#x27;koa-memcached&#x27;);
                        return memcachedStore(this._sessionStorageOptions);
                }

                /**
                 *  写AccessLog的中间件。
                 *  如果需要记录会话用户，则需要在后续中间件或者route或action中设置session.user.id至koa context
                 *
                 * @method _createAccessLogger
                 * @return {generator} 符合koa中间件规范的AccessLog的generator对象。
                 * @private
                 * @since 0.1.0
                 * @author zlbbq
                 * */
                _createAccessLogger () {
                        var me = this;
                        return function * (next) {
                                var d = new Date();
                                yield next;
                                if(this.status == 404) {return;}
                                var t = new Date() - d;
                                var o = {
                                        &#x27;app-id&#x27; : me.appId,
                                        &#x27;app-key&#x27; : me.appKey,
                                        pid : process.pid,
                                        uptime : parseInt(process.uptime()),
                                        server : (me.name + &#x27;@&#x27; + EasyNode.getLocalIP() + &#x27;:&#x27; + me.port) || (&#x27;koa-http-server@&#x27; + EasyNode.getLocalIP() + &#x27;:&#x27; + me.port),
                                        time : d.toFormat(&#x27;YYYY-MM-DD HH:MI:SS&#x27;),
                                        method : this.method,
                                        url : this.url.replace(/\?.*$/, &#x27;&#x27;),
                                        status : this.status,
                                        cost : t,
                                        &#x27;render-cost&#x27; : this.renderCost || 0,                   // to write the performance of view engine such as ejs or mustache
                                                                                                                          // set renderCost attribute to koa context.
                                        action : this.action,                                               // see KOADefaultRoutes._execAction();
                                        remote : this.remoteAddress,                            //remote address
                                        user : this.session &amp;&amp; this.session.user &amp;&amp; this.session.user.id || &#x27;[UNKNOWN]&#x27;         //user id in the session
                                };
                                accessLogger.info(JSON.stringify(o));
                                me.trigger(KOAHttpServer.Events.EVENT_ACCESS, o);
                        };
                }

                /**
                 *  默认Routes。
                 *
                 * @method _createDefaultRoutes
                 * @param {koa} app koa实例
                 * @private
                 * @since 0.1.0
                 * @author zlbbq
                 * */
                _createDefaultRoutes (app) {
                        var DefaultRoutes = using(&#x27;easynode.framework.server.http.KOADefaultRoutes&#x27;);
                        new DefaultRoutes(app, route, this._actionContextListener).addRoutes();
                }

                /**
                 *  增加用户定义的Routes(通过addRoute函数)。
                 *
                 * @method _createDefaultRoutes
                 * @param {koa} app koa实例
                 * @private
                 * @since 0.1.0
                 * @author zlbbq
                 * */
                _createExtraRoutes (app) {
                        this._routes = this._routes || [];
                        this._routes.forEach(o =&gt; {
                                if(typeof route[o.method] == &#x27;function&#x27;) {
                                        app.use(route[o.method].call(null, o.uri, o.gen));
                                }
                                else {
                                        throw new Error(&#x60;Unsupported http method [${o.method}]&#x60;);
                                }
                        });
                }

                /**
                 *  增加用户定义的Middleware(通过addMiddleware函数)。
                 *
                 * @method _createExtraMiddlewares
                 * @param {koa} app koa实例
                 * @private
                 * @since 0.1.0
                 * @author zlbbq
                 * */
                _createExtraMiddlewares (app) {
                        this._middlewares = this._middlewares || [];
                        this._middlewares.forEach(middleware =&gt; {
                                app.use(middleware);
                        });
                }

                /**
                 *  加载默认中间件。
                 *
                 * @method _createDefaultMiddlewares
                 * @param {koa} app koa实例
                 * @private
                 * @since 0.1.0
                 * @author zlbbq
                 * */
                _createDefaultMiddlewares (app) {
                        // anytime goes here, this.query will be the parse result of query string, this.parts will be the parsed body of request if
                        // it is a POST method now
                        app.use(function * (next) {
                                var me = this;
                                // add parameter attribute to ctx, so the downstream middlewares could access this attribute to fetch parameters from
                                // query string or body
                                this.parameter = new KOAHttpRequestParameter(this.query, this.parts);
                                yield next;
                        });
                }

                /**
                 *  增加multipart-form-data支持。
                 *
                 * @method _createMultipartMiddleware
                 * @param {koa} app koa实例
                 * @private
                 * @since 0.1.0
                 * @author zlbbq
                 * */
                _createMultipartMiddleware (app) {
                        var supportFileTypes = &#x27;^.*\.(?:png|jpg|bmp|gif|jpeg|txt|doc|xls|xlsx|ppt|pptx|pdf|zip|tar|gz|rar|swf|mp3|mp4|log)$&#x27;;
                        supportFileTypes = EasyNode.config(&#x27;easynode.servers.koa-HttpServer.upload.types&#x27;, supportFileTypes);
                        var regEx = new RegExp(supportFileTypes);
                        var me = this;
                        app.use(function* (next) {
                                        //this.state.upload=0;
                                        //if (this.method.toLocaleLowerCase() == &#x27;post&#x27;) {
                                        //        var hasError = false;
                                        //        var parts = yield* multipart(this);
                                        //        parts.files.forEach(file =&gt; {
                                        //                if(!file.filename.match(regEx)) {
                                        //                        parts.dispose();
                                        //                        this.status = 403;
                                        //                        this.body = &#x60;403 Forbidden : Unsupported type of upload file [${file.filename}]&#x60;;
                                        //                        hasError = true;                //ignore downstream middleware
                                        //                }
                                        //                f.rename(file.path, me.getUploadDir() + file.filename,function(err){
                                        //                    if(err){
                                        //                        EasyNode.DEBUG &amp;&amp; logger.debug(&#x60;rename ${file.path} to ${me.getUploadDir()+file.filename} err&#x60;,err.message);
                                        //                    }
                                        //                    else {
                                        //                        var zip = AdmZip(me.getUploadDir() + file.filename);
                                        //                        zip.extractAllTo(me.getUploadDir(), true);
                                        //                        EasyNode.DEBUG &amp;&amp; logger.debug(&#x60;rename ${file.path} to ${me.getUploadDir()+file.filename} success&#x60;);
                                        //                    }
                                        //                });
                                        //        });
                                        //        if(!hasError) {
                                        //            this.parts = parts;
                                        //                if( ~this.req.url.indexOf(&#x27;/idmanager&#x27;) &amp;&amp; this.req.method.toLowerCase() === &#x27;post&#x27; ){
                                        //                    this.state.upload = 1;
                                        //                    var filename = this.parts.files[0].filename;
                                        //                    this.state.relativePath =  me.getUploadURIPrefix() + path.basename( filename, path.extname(filename));
                                        //                    this.state.relativeFilename = this.state.relativePath + &#x27;/start.html&#x27;;
                                        //                }
                                        //            parts.dispose();
                                        //            yield next;
                                        //
                                        //        }
                                        //}
                                        //else {
                                                // for compatibility
                                                this.parts = {
                                                        files : [],
                                                        fields : []
                                                };
                                                yield next;
                                       // }
                                }
                        );
                }

                /**
                 *  增加在Route之后的middleware, 通过addMiddlewareAfterRoutes
                 *
                 * @method _createMiddlewaresAfterRoutes
                 * @param {koa} app koa实例
                 * @private
                 * @since 0.1.0
                 * @author zlbbq
                 * */
                _createMiddlewaresAfterRoutes (app) {
                        this._middlewaresAfterRoutes = this._middlewaresAfterRoutes || [];
                        this._middlewaresAfterRoutes.forEach(middleware =&gt; {
                                app.use(middleware);
                        });
                }
                /**
                 *  增加用户定义的静态文件目录(通过addWebDirs函数)。
                 *
                 * @method _addExtraWebDirs
                 * @param {koa} app koa实例
                 * @private
                 * @since 0.1.0
                 * @author zlbbq
                 * */
                _addExtraWebDirs (app) {
                        this._webDirs = this._webDirs || [];
                        this._webDirs.forEach(dir =&gt; {
                                app.use(staticFileServe(EasyNode.real(dir)));
                        });
                }

                /**
                 *  增加用户定义的模板文件目录(通过addTemplateDirs函数)。
                 * @method _addTemplate
                 * @param {koa} app koa实例
                 * @private
                 * @since 0.1.0
                 * @author allen.hu
                 * */
                _addTemplate(app){
                    this._templateDirs = this._templateDirs || [];
                    this._templateDirs.forEach(dir =&gt; {
                        render(app, {
                            root: EasyNode.real(dir),
                            layout: &#x27;&#x27;,
                            viewExt: &#x27;html&#x27;,
                            cache: false,
                            debug: true,
                            filters: filters
                        });
                    });
                }

                /**
                 * 启动KOAHttpServer并加载中间件，中间件会按先后顺序添加到koa，具体流程如下：&lt;br&gt;
                 *          favicon-&gt;access log-&gt;static files(包括所有静态文件目录)-&gt;session-&gt;csrf-&gt;$middlewares-&gt;default routes-&gt;$extra routes-&gt;$middleware-after-routes
                 *
                 * @method start
                 * @overwrite
                 * @private
                 * @since 0.1.0
                 * @author zlbbq
                 * */
                start () {
                        var me = this;
                        return function * () {
                                /**
                                 * koa Application实例
                                 * @property _app
                                 * @type {koa.Application}
                                 * @private
                                 * @since 0.1.0
                                 * @author zlbbq
                                 * */
                                var app = me._app = koa();
                                //trigger before-start event
                                me.trigger(AbstractServer.EVENT_BEFORE_START);

                                // set key of app
                                app.keys = me._keys;
                                app.name = me.name;

                                // add favicon support
                                app.use(favicon(path.join(me.getWebRoot(), &#x27;favicon.ico&#x27;)));

                                // serve static files
                                //HTTP ROOT
                                app.use(staticFileServe(me.getWebRoot()));
                                //Additional web dirs
                                me._addExtraWebDirs(app);


                                me._addTemplate(app);

        //=========================dynamic request below=========================//

                                //set remote address
                                app.use(function * (next){
                                        var req = this.req;
                                        var address = req.headers[PROXY_IP_HEADER] ||
                                                (req.connection &amp;&amp; req.connection.remoteAddress) ||
                                                (req.socket &amp;&amp; req.socket.remoteAddress) ||
                                                (req.connection.socket &amp;&amp; req.connection.socket.remoteAddress) || &#x27;0.0.0.0&#x27;;
                                        address = address.replace(/:.*:/, &#x27;&#x27;);                  //convert to pure IPv4
                                        this.remoteAddress = address;
                                        yield next;
                                });


                                // access log
                                if (me.writeAccessLog()) {
                                        app.use(me._createAccessLogger());
                                }

                                // session support
                                app.use(session({
                                        store: me._getSessionStore()
                                }));

                                //csrf support
                                if (me._enableCSRF === true) {
                                        var csrf = require(&#x27;koa-csrf&#x27;);
                                        csrf(app);
                                        app.use(csrf.middleware);
                                }

                                // parse url query string and body before any middleware defined by user is running
                                qs(app, &#x27;first&#x27;);                       // /foo?a=b&amp;a=c         this.query.a = &#x27;b&#x27; , not a = [&#x27;b&#x27;, &#x27;c&#x27;]

                                // support multipart-form-data
                                me._createMultipartMiddleware(app);

                                // default middlewares
                                me._createDefaultMiddlewares(app);

                                // user defined middlewares
                                me._createExtraMiddlewares(app);

                                // inner routes
                                me._createDefaultRoutes(app);

                                // user defined routes
                                me._createExtraRoutes(app);

                                // middleware after routes
                                me._createMiddlewaresAfterRoutes(app);

                                // handle error 404
                                if (me._enable404Middleware !== false) {
                                        app.use(function * () {
                                                if (this.status == 404) {
                                                        var uri = this.url.replace(/\?.*$/gm, &#x27;&#x27;);
                                                        var content404 = me._404Content;
                                                        if (!content404) {
                                                                EasyNode.DEBUG &amp;&amp; logger.debug(&#x27;load 404 content from 404.html&#x27;);
                                                                var config404 = EasyNode.config(&#x27;easynode.servers.koa-HttpServer.404&#x27;, &#x27;404.html&#x27;);
                                                                var page404 = path.join(me.getWebRoot(), config404);
                                                                var content404 = &#x27;&lt;h1&gt;404 Resource Not Found : ${URI}&lt;/h1&gt;&#x27;;
                                                                if (yield fs.exists(page404)) {
                                                                        content404 = yield fs.readFile(page404);
                                                                }
                                                                me._404Content = content404;
                                                        }
                                                        content404 = content404.toString().replace(/\$\{URI\}/gm, uri);
                                                        this.type = &#x27;html&#x27;;
                                                        this.body = content404;
                                                        this.status = 404;
                                                }
                                        });
                                }

                                //auto-generate nginx configuration
                                if(EasyNode.config(&#x27;easynode.servers.koa-HttpServer.generateNginxConfig&#x27;, &#x27;0&#x27;) == &#x27;1&#x27;) {
                                        var nginxConfTemplate = EasyNode.real(&#x27;etc/nginx-conf.mst&#x27;);
                                        var nginxVPTemplate = EasyNode.real(&#x27;etc/nginx-vp-conf.mst&#x27;);
                                        var sCfg = &#x27;&#x27;;
                                        var sVP = &#x27;&#x27;;
                                        var extraDirs = me.getWebDirs();
                                        var vpRegexp = /.*\/(.+)\/www\/?$/;
                                        //virtual path
                                        for(var i = 0;i&lt;extraDirs.length;i++) {
                                                var p = extraDirs[i];
                                                var vp = &#x27;&#x27;;
                                                if(p.match(vpRegexp)) {
                                                        vp = vpRegexp.exec(p)[1];
                                                        sVP += yield MustacheHelper.renderFile(nginxVPTemplate, {
                                                                virtualPathName : vp,
                                                                virtualPathRoot : EasyNode.real(p)
                                                        });
                                                        sVP += &#x27;\n\n\n&#x27;;
                                                }
                                        }
                                        //nginx conf
                                        sCfg = yield MustacheHelper.renderFile(nginxConfTemplate, {
                                                rootDir : me.getWebRoot(),
                                                serviceIP : EasyNode.getLocalIP(),
                                                servicePort : me.port,
                                                virtualPath : sVP
                                        });

                                        var nginxConfigFile = EasyNode.real(&#x27;etc/nginx.conf&#x27;);
                                        yield fs.writeFile(nginxConfigFile, sCfg);
                                        logger.info(&#x60;nginx config file is auto-generated at [${nginxConfigFile}]&#x60;);
                                }

                                var fnListen = thunkify(app.listen);
                                            yield fnListen.call(app, me.port);
                                            logger.info(&#x60;[${me.name}] is listening on port [${me.port}]...&#x60;);
                                            me.trigger(AbstractServer.EVENT_STARTED);
                                    };
                }

                /**
                 * 获取客户端连接列表。KOAHttpServer只返回一个空的数组。
                 *
                 * @method connections
                 * @abstract
                 * @return {Array} 客户端连接列表，每个客户端连接应至少包含一个token字标用于唯一标识一个客户端连接
                 * @async
                 * @since 0.1.0
                 * @author zlbbq
                 * */
                connections () {
                        return [];
                }

                /**
                 * 向客户端发送消息。HTTP服务不支持主动向客户端发送消息，仅抛出错误。
                 *
                 * @method send
                 * @param {Array/String} clientTokens 客户端Token列表，客户端Token可以唯一识别一个客户端。传递Array时，
                 *                                      向多个客户端发送消息
                 * @param {Buffer} msg 消息体
                 * @return {Array} 客户端列表
                 * @abstract
                 * @async
                 * @since 0.1.0
                 * @author zlbbq
                 * */
                send(clientTokens, msg) {
                        throw new Error(&#x27;This is http server, do you think it is able to work?&#x27;);
                }

                /**
                 * 向所有客户端广播消息。HTTP服务不支持主动向客户端发送消息，仅抛出错误。
                 *
                 * @method broadcast
                 * @param {Buffer} msg 消息体
                 * @return {Array} 客户端列表
                 * @abstract
                 * @async
                 * @since 0.1.0
                 * @author zlbbq
                 * */
                broadcast (msg) {
                        throw new Error(&#x27;This is http server, do you think it is able to work?&#x27;);
                }

                getClassName() {
                        return EasyNode.namespace(__filename);
                }
        }

        /**
         *      session存储类型常量。
         *      &lt;pre&gt;
         *      KOAHttpServer.SessionSupport.STORAGE_MEMORY = &#x27;storage-memory&#x27;;
         *      KOAHttpServer.SessionSupport.STORAGE_REDIS = &#x27;storage-redis&#x27;;
         *      KOAHttpServer.SessionSupport.STORAGE_MEMCACHED = &#x27;storage-memcached&#x27;;
         *      &lt;/pre&gt;
         *      &lt;h5&gt;Example&lt;/h5&gt;
         *      &lt;pre&gt;
         *var KOAHttpServer = using(&#x27;easynode.framework.server.http.KOAHttpServer&#x27;);
         *var server = new KOAHttpServer();
         *
         * server.setSessionStorage(KOAHttpServer.SessionSupport.STORAGE_REDIS, {
         *         host : &#x27;127.0.0.1&#x27;,
         *         port : 6379
         * });
         *
         * server.setSessionStorage(KOAHttpServer.SessionSupport.STORAGE_MEMCACHED, {
         *         host : &#x27;127.0.0.1&#x27;,
         *         port : 11211
         * });
         *
         * server.setSessionStorage(KOAHttpServer.SessionSupport.STORAGE_MEMORY);
         *      &lt;/pre&gt;
         *
         * @class easynode.framework.server.http.KOAHttpServer.SessionSupport
         * @since 0.1.0
         * @author zlbbq
         * */
        KOAHttpServer.SessionSupport = {};

        KOAHttpServer.SessionSupport.STORAGE_MEMORY = &#x27;storage-memory&#x27;;

        KOAHttpServer.SessionSupport.STORAGE_REDIS = &#x27;storage-redis&#x27;;

        KOAHttpServer.SessionSupport.STORAGE_MEMCACHED = &#x27;storage-memcached&#x27;;

        KOAHttpServer.Events = {};

        /**
         * 用户访问动态内容时触发。
         *
         * @event access
         * @since 0.1.0
         * @author zlbbq
         * */
        KOAHttpServer.Events.EVENT_ACCESS = &#x27;access&#x27;;

        module.exports = KOAHttpServer;
})();
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
